<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–±–ª–∏—Ü—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ Mobile.de</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .controls {
            padding: 15px 20px;
            background-color: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .save-btn { background: #27ae60; color: white; }
        .save-btn:hover { background: #219a52; }
        .clear-btn { background: #e74c3c; color: white; }
        .clear-btn:hover { background: #c0392b; }
        .add-btn { background: #3498db; color: white; }
        .add-btn:hover { background: #2980b9; }
        .cancel-btn { background: #95a5a6; color: white; }
        .cancel-btn:hover { background: #7f8c8d; }
        
        .info-text {
            margin-left: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .add-car-form {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            border: 2px dashed #bdc3c7;
            display: none;
        }
        .add-car-form.show {
            display: block;
        }
        .form-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .form-actions {
            display: flex;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        th {
            background-color: #34495e;
            color: white;
            padding: 15px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #2c3e50;
            font-size: 14px;
        }
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: top;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
            transition: background-color 0.3s ease;
        }
        .link-cell {
            max-width: 180px;
            word-break: break-all;
        }
        .link-cell a {
            color: #3498db;
            text-decoration: none;
            font-size: 13px;
        }
        .link-cell a:hover {
            text-decoration: underline;
            color: #2980b9;
        }
        .editable-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            padding: 4px;
            font-family: inherit;
            font-size: 14px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        .editable-input:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .brand-model-input {
            font-weight: 600;
            color: #2c3e50;
            min-width: 150px;
        }
        .features-input {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
            min-width: 120px;
        }
        .mileage-input, .price-input {
            font-size: 14px;
            color: #2980b9;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
        }
        .price-input {
            color: #27ae60;
            font-weight: 600;
        }
        .rating-cell {
            text-align: center;
            width: 150px;
        }
        .rating-buttons {
            display: flex;
            gap: 3px;
            justify-content: center;
            margin-bottom: 5px;
            flex-wrap: wrap;
        }
        .rating-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1px;
        }
        .priority-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        .priority-btn:hover {
            background: linear-gradient(45deg, #e67e22, #d35400);
            transform: scale(1.1);
        }
        .priority-btn.active {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            box-shadow: 0 0 15px rgba(142, 68, 173, 0.8);
            animation: pulse 2s infinite;
        }
        .interesting-btn {
            background: #27ae60;
            color: white;
        }
        .interesting-btn:hover {
            background: #219a52;
            transform: scale(1.1);
        }
        .interesting-btn.active {
            background: #16a085;
            box-shadow: 0 0 10px rgba(22, 160, 133, 0.5);
        }
        .not-interesting-btn {
            background: #95a5a6;
            color: white;
        }
        .not-interesting-btn:hover {
            background: #7f8c8d;
            transform: scale(1.1);
        }
        .not-interesting-btn.active {
            background: #34495e;
            box-shadow: 0 0 10px rgba(52, 73, 94, 0.5);
        }
        .status-priority {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            color: white;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        .status-interesting {
            background: #d5f4e6;
            color: #27ae60;
        }
        .status-not-interesting {
            background: #ecf0f1;
            color: #7f8c8d;
        }
        .status-neutral {
            background: #f8f9fa;
            color: #7f8c8d;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .comment-cell {
            width: 250px;
        }
        .comment-input {
            width: 100%;
            min-height: 60px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            padding: 8px;
            font-family: inherit;
            font-size: 13px;
            resize: vertical;
        }
        .comment-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .status-indicator {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        .status-liked {
            background: #d5f4e6;
            color: #27ae60;
        }
        .status-disliked {
            background: #fadbd8;
            color: #e74c3c;
        }
        .actions-cell {
            width: 60px;
            text-align: center;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        @media (max-width: 1400px) {
            .container {
                margin: 10px;
                overflow-x: auto;
            }
            table {
                min-width: 1300px;
            }
        }
        @media (max-width: 768px) {
            .comment-cell {
                width: 200px;
            }
            .comment-input {
                min-height: 50px;
            }
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .info-text {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó –¢–∞–±–ª–∏—Ü—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ Mobile.de</h1>
            <p>–•–º–∞—Ä–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Firebase</p>
        </div>
        
        <div class="sync-status" id="syncStatus" style="padding: 10px 20px; background: #f8f9fa; border-bottom: 1px solid #dee2e6; text-align: center; font-size: 14px;">
            <span style="color: #ffc107;">üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...</span>
        </div>
        
        <div class="controls">
            <button class="btn save-btn" onclick="forceSyncToCloud()">‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
            <button class="btn clear-btn" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
            <button class="btn add-btn" onclick="toggleAddForm()">‚ûï –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ</button>
            <button class="btn" style="background: #8e44ad; color: white;" onclick="sortByPriority()">üèÜ –°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º</button>
            <button class="btn" style="background: #17a2b8; color: white;" onclick="resetToDefaults()">üîÑ –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –∞–≤—Ç–æ</button>
            <span class="info-text">
                ‚òÅÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase + localStorage backup
            </span>
        </div>
        
        <div class="add-car-form" id="addCarForm">
            <h3>‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å</h3>
            <div class="form-group">
                <input type="text" id="newCarBrand" class="form-input" placeholder="–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å" required>
                <input type="text" id="newCarType" class="form-input" placeholder="–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞" value="–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥">
            </div>
            <div class="form-group">
                <input type="text" id="newCarMileage" class="form-input" placeholder="–ü—Ä–æ–±—ñ–≥ (–∫–º)">
                <input type="text" id="newCarPrice" class="form-input" placeholder="–¶—ñ–Ω–∞ (‚Ç¨)">
            </div>
            <div class="form-group">
                <input type="text" id="newCarFeatures" class="form-input" placeholder="–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ">
                <input type="url" id="newCarUrl" class="form-input" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è" required>
            </div>
            <div class="form-actions">
                <button class="btn add-btn" onclick="addNewCar()">‚úÖ –î–æ–¥–∞—Ç–∏</button>
                <button class="btn cancel-btn" onclick="toggleAddForm()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>‚Ññ</th>
                    <th>–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å</th>
                    <th>–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞</th>
                    <th>–ü—Ä–æ–±—ñ–≥</th>
                    <th>–¶—ñ–Ω–∞</th>
                    <th>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ</th>
                    <th>–û—Ü—ñ–Ω–∫–∞</th>
                    <th>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</th>
                    <th>–ü–æ—Å–∏–ª–∞–Ω–Ω—è</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody id="carTable">
            </tbody>
        </table>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const firebaseConfig = {
            apiKey: "AIzaSyDl_ZYOx4rvJqYhz5a3rjFCa0XU0Elx4tA",
            authDomain: "car-table-app.firebaseapp.com",
            projectId: "car-table-app",
            storageBucket: "car-table-app.firebasestorage.app",
            messagingSenderId: "1089172844020",
            appId: "1:1089172844020:web:77e5936de00905c1d5dda1"
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // –ó—Ä–æ–±–∏—Ç–∏ Firebase –¥–æ—Å—Ç—É–ø–Ω–∏–º –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.firebaseDb = db;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseOnSnapshot = onSnapshot;
        window.isFirebaseReady = true;

        // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
        const statusElement = document.getElementById('syncStatus');
        if (statusElement) {
            statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>';
        }

        console.log('Firebase —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
    </script>

    <script>
        // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
        let carsData = [
            {
                id: "426743473",
                brand: "Mercedes-Benz GLC 300",
                type: "–ì—ñ–±—Ä–∏–¥",
                mileage: "85,000 –∫–º",
                price: "42,500 ‚Ç¨",
                features: "AHK, –ö–∞–º–µ—Ä–∞, –ü–∞–Ω–æ—Ä–∞–º–∞",
                url: "https://suchen.mobile.de/auto-inserat/mercedes-benz-glc-300-ahk-kamera-pano/426743473.html"
            },
            {
                id: "418664792",
                brand: "Mercedes-Benz GLE 350",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "45,000 –∫–º",
                price: "38,900 ‚Ç¨",
                features: "–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=418664792"
            },
            {
                id: "423350671",
                brand: "Mercedes-Benz C 300",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "62,000 –∫–º",
                price: "35,500 ‚Ç¨",
                features: "AMG –ø–∞–∫–µ—Ç",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423350671"
            },
            {
                id: "420538971",
                brand: "Mercedes-Benz E 300",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "78,000 –∫–º",
                price: "43,200 ‚Ç¨",
                features: "–ü–æ–≤–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=420538971"
            },
            {
                id: "427620635",
                brand: "Mercedes-Benz GLC 300",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "55,000 –∫–º",
                price: "39,800 ‚Ç¨",
                features: "4MATIC, Premium",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427620635"
            },
            {
                id: "411812367",
                brand: "Mercedes-Benz S 400",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "92,000 –∫–º",
                price: "52,000 ‚Ç¨",
                features: "Eye Catcher, –õ—é–∫—Å",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=411812367"
            },
            {
                id: "423733871",
                brand: "Mercedes-Benz A 250",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "35,000 –∫–º",
                price: "32,500 ‚Ç¨",
                features: "AMG Line, –ö–æ–º–ø–∞–∫—Ç",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423733871"
            },
            {
                id: "414802954",
                brand: "Mercedes-Benz CLA 250",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "48,000 –∫–º",
                price: "36,900 ‚Ç¨",
                features: "–ö—É–ø–µ —Å—Ç–∏–ª—å",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414802954"
            },
            {
                id: "425386910",
                brand: "Mercedes-Benz GLA 250",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "28,000 –∫–º",
                price: "37,500 ‚Ç¨",
                features: "–ö–æ–º–ø–∞–∫—Ç–Ω–∏–π SUV",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=425386910"
            },
            {
                id: "422158453",
                brand: "Mercedes-Benz GLB 250",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "41,000 –∫–º",
                price: "40,200 ‚Ç¨",
                features: "7 –º—ñ—Å—Ü—å, –°—ñ–º–µ–π–Ω–∏–π",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=422158453"
            },
            {
                id: "424538448",
                brand: "BMW X5 xDrive45e",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "65,000 –∫–º",
                price: "44,800 ‚Ç¨",
                features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –≤—ñ–¥ 2022 —Ä.",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=424538448"
            },
            {
                id: "421648521",
                brand: "BMW 330e",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "52,000 –∫–º",
                price: "38,500 ‚Ç¨",
                features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –°–ø–æ—Ä—Ç –ø–∞–∫–µ—Ç",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=421648521"
            },
            {
                id: "414011356",
                brand: "Audi Q5 55 TFSI e",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "38,000 –∫–º",
                price: "42,900 ‚Ç¨",
                features: "Quattro, –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414011356"
            },
            {
                id: "415765423",
                brand: "Volvo XC60 T8",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "45,000 –∫–º",
                price: "39,500 ‚Ç¨",
                features: "–≤—ñ–¥ 2020 —Ä., AWD",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=415765423"
            },
            {
                id: "427272252",
                brand: "Porsche Cayenne E-Hybrid",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                mileage: "58,000 –∫–º",
                price: "48,500 ‚Ç¨",
                features: "–°–ø–æ—Ä—Ç —Ö—Ä–æ–º–æ, –ü—Ä–µ–º—ñ—É–º",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427272252"
            }
        ];

        // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–æ–∫ —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤
        let carRatings = {};
        let carComments = {};
        let isFirebaseReady = false;

        // –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å Firebase
        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.isFirebaseReady && window.firebaseDb) {
                        isFirebaseReady = true;
                        resolve();
                    } else {
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        // Firebase —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        async function syncToFirebase() {
            if (!isFirebaseReady) return false;
            
            try {
                const dataToSync = {
                    carsData: carsData,
                    carRatings: carRatings,
                    carComments: carComments,
                    lastUpdated: new Date().toISOString()
                };

                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                await window.firebaseSetDoc(docRef, dataToSync);
                
                const statusElement = document.getElementById('syncStatus');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ —Ö–º–∞—Ä–æ—é</span>';
                }
                
                console.log('–î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –∑ Firebase');
                return true;
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ Firebase:', error);
                const statusElement = document.getElementById('syncStatus');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #dc3545;">‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó</span>';
                }
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!isFirebaseReady) {
                console.log('Firebase –Ω–µ –≥–æ—Ç–æ–≤–∏–π');
                return false;
            }
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                const docSnap = await window.firebaseGetDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –¥–∞–Ω—ñ –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ
                    if (data.carsData && data.carsData.length > 0) {
                        carsData = data.carsData;
                        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ –∑ Firebase:', carsData.length);
                    }
                    if (data.carRatings) {
                        carRatings = data.carRatings;
                        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∑ Firebase:', Object.keys(carRatings).length);
                    }
                    if (data.carComments) {
                        carComments = data.carComments;
                        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑ Firebase:', Object.keys(carComments).length);
                    }
                    
                    console.log('–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∑ Firebase');
                    return true;
                } else {
                    console.log('–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ —ñ—Å–Ω—É—î –≤ Firebase, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ');
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤ Firebase
                    await syncToFirebase();
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Firebase:', error);
            }
            return false;
        }

        // Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        function setupRealtimeSync() {
            if (!isFirebaseReady) return;
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                window.firebaseOnSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        if (data.carsData) carsData = data.carsData;
                        if (data.carRatings) carRatings = data.carRatings;
                        if (data.carComments) carComments = data.carComments;
                        
                        generateTable();
                        
                        const statusElement = document.getElementById('syncStatus');
                        if (statusElement) {
                            statusElement.innerHTML = '<span style="color: #17a2b8;">üîÑ –û–Ω–æ–≤–ª–µ–Ω–æ –∑ —Ö–º–∞—Ä–∏</span>';
                            setTimeout(() => {
                                statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ</span>';
                            }, 2000);
                        }
                    }
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:', error);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        async function loadSavedData() {
            console.log('–ü–æ—á–∞—Ç–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...');
            
            // –°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ localStorage (—à–≤–∏–¥–∫–æ)
            try {
                const savedRatings = localStorage.getItem('carRatings');
                const savedComments = localStorage.getItem('carComments');
                const savedCars = localStorage.getItem('carsData');
                
                if (savedRatings) {
                    carRatings = JSON.parse(savedRatings);
                    console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∑ localStorage:', Object.keys(carRatings).length);
                }
                if (savedComments) {
                    carComments = JSON.parse(savedComments);
                    console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑ localStorage:', Object.keys(carComments).length);
                }
                if (savedCars && savedCars !== '[]') {
                    carsData = JSON.parse(savedCars);
                    console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ –∑ localStorage:', carsData.length);
                } else {
                    console.log('–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤');
                }
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage:', error);
            }

            // –ü–æ—Ç—ñ–º —á–µ–∫–∞—î–º–æ Firebase —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ —Ö–º–∞—Ä–∏
            await waitForFirebase();
            const firebaseLoaded = await loadFromFirebase();
            
            if (firebaseLoaded) {
                setupRealtimeSync();
                console.log('Firebase real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞');
            } else {
                console.log('Firebase –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è, –ø—Ä–∞—Ü—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ');
            }
        }

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–ø–æ–¥–≤—ñ–π–Ω–µ: localStorage + Firebase)
        async function autoSave() {
            // –ó–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage (—à–≤–∏–¥–∫–æ)
            try {
                localStorage.setItem('carRatings', JSON.stringify(carRatings));
                localStorage.setItem('carComments', JSON.stringify(carComments));
                localStorage.setItem('carsData', JSON.stringify(carsData));
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ localStorage:', error);
            }

            // –Ü –≤ Firebase —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π
            if (isFirebaseReady) {
                await syncToFirebase();
            }
        }

        // –ü—Ä–∏–º—É—Å–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        async function forceSyncToCloud() {
            const statusElement = document.getElementById('syncStatus');
            if (statusElement) {
                statusElement.innerHTML = '<span style="color: #ffc107;">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...</span>';
            }
            
            await autoSave();
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
        async function clearAllData() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ (–∞–≤—Ç–æ, –æ—Ü—ñ–Ω–∫–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ)?')) {
                carRatings = {};
                carComments = {};
                localStorage.removeItem('carRatings');
                localStorage.removeItem('carComments');
                localStorage.removeItem('carsData');
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ Firebase
                if (isFirebaseReady) {
                    try {
                        const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                        await window.firebaseSetDoc(docRef, {
                            carsData: [],
                            carRatings: {},
                            carComments: {},
                            lastUpdated: new Date().toISOString()
                        });
                    } catch (error) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è Firebase:', error);
                    }
                }
                
                location.reload();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è
        function toggleAddForm() {
            const form = document.getElementById('addCarForm');
            if (form) {
                form.classList.toggle('show');
                
                if (form.classList.contains('show')) {
                    const brandInput = document.getElementById('newCarBrand');
                    if (brandInput) brandInput.focus();
                } else {
                    // –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
                    const inputs = ['newCarBrand', 'newCarMileage', 'newCarPrice', 'newCarFeatures', 'newCarUrl'];
                    inputs.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) element.value = '';
                    });
                    const typeInput = document.getElementById('newCarType');
                    if (typeInput) typeInput.value = '–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥';
                }
            }
        }

        // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
        async function addNewCar() {
            const brand = document.getElementById('newCarBrand')?.value?.trim() || '';
            const type = document.getElementById('newCarType')?.value?.trim() || '–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥';
            const mileage = document.getElementById('newCarMileage')?.value?.trim() || '';
            const price = document.getElementById('newCarPrice')?.value?.trim() || '';
            const features = document.getElementById('newCarFeatures')?.value?.trim() || '';
            const url = document.getElementById('newCarUrl')?.value?.trim() || '';

            if (!brand || !url) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è: –ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å —Ç–∞ –ü–æ—Å–∏–ª–∞–Ω–Ω—è');
                return;
            }

            // –ì–µ–Ω–µ—Ä—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
            const newId = 'manual_' + Date.now();

            // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
            const newCar = {
                id: newId,
                brand: brand,
                type: type,
                mileage: mileage,
                price: price,
                features: features,
                url: url
            };

            carsData.push(newCar);
            await autoSave();
            generateTable();
            toggleAddForm();
        }

        // –í–∏–¥–∞–ª–∏—Ç–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
        async function deleteCar(carId) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å?')) {
                carsData = carsData.filter(car => car.id !== carId);
                delete carRatings[carId];
                delete carComments[carId];
                await autoSave();
                generateTable();
            }
        }

        // –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è
        async function updateCarData(carId, field, value) {
            const car = carsData.find(c => c.id === carId);
            if (car) {
                car[field] = value;
                await autoSave();
            }
        }

        // –û—Ü—ñ–Ω–∫–∞ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è
        async function rateCar(carId, rating) {
            // –Ø–∫—â–æ –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ —Ç—É –∂ –∫–Ω–æ–ø–∫—É - —Å–∫–∏–¥–∞—î–º–æ –æ—Ü—ñ–Ω–∫—É
            if (carRatings[carId] === rating) {
                delete carRatings[carId];
            } else {
                carRatings[carId] = rating;
            }
            
            await autoSave();
            updateRatingDisplay(carId);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è
        async function updateComment(carId, comment) {
            carComments[carId] = comment;
            await autoSave();
        }

        // –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        async function resetToDefaults() {
            if (confirm('–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ 15 –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤? (–í–∞—à—ñ –¥–æ–¥–∞–Ω—ñ –∞–≤—Ç–æ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ, –∞–ª–µ –æ—Ü—ñ–Ω–∫–∏ —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑–±–µ—Ä–µ–∂—É—Ç—å—Å—è)')) {
                // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –º–∞—Å–∏–≤ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
                carsData = [
                    {
                        id: "426743473",
                        brand: "Mercedes-Benz GLC 300",
                        type: "–ì—ñ–±—Ä–∏–¥",
                        mileage: "85,000 –∫–º",
                        price: "42,500 ‚Ç¨",
                        features: "AHK, –ö–∞–º–µ—Ä–∞, –ü–∞–Ω–æ—Ä–∞–º–∞",
                        url: "https://suchen.mobile.de/auto-inserat/mercedes-benz-glc-300-ahk-kamera-pano/426743473.html"
                    },
                    {
                        id: "418664792",
                        brand: "Mercedes-Benz GLE 350",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "45,000 –∫–º",
                        price: "38,900 ‚Ç¨",
                        features: "–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=418664792"
                    },
                    {
                        id: "423350671",
                        brand: "Mercedes-Benz C 300",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "62,000 –∫–º",
                        price: "35,500 ‚Ç¨",
                        features: "AMG –ø–∞–∫–µ—Ç",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423350671"
                    },
                    {
                        id: "420538971",
                        brand: "Mercedes-Benz E 300",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "78,000 –∫–º",
                        price: "43,200 ‚Ç¨",
                        features: "–ü–æ–≤–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=420538971"
                    },
                    {
                        id: "427620635",
                        brand: "Mercedes-Benz GLC 300",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "55,000 –∫–º",
                        price: "39,800 ‚Ç¨",
                        features: "4MATIC, Premium",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427620635"
                    },
                    {
                        id: "411812367",
                        brand: "Mercedes-Benz S 400",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "92,000 –∫–º",
                        price: "52,000 ‚Ç¨",
                        features: "Eye Catcher, –õ—é–∫—Å",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=411812367"
                    },
                    {
                        id: "423733871",
                        brand: "Mercedes-Benz A 250",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "35,000 –∫–º",
                        price: "32,500 ‚Ç¨",
                        features: "AMG Line, –ö–æ–º–ø–∞–∫—Ç",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423733871"
                    },
                    {
                        id: "414802954",
                        brand: "Mercedes-Benz CLA 250",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "48,000 –∫–º",
                        price: "36,900 ‚Ç¨",
                        features: "–ö—É–ø–µ —Å—Ç–∏–ª—å",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414802954"
                    },
                    {
                        id: "425386910",
                        brand: "Mercedes-Benz GLA 250",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "28,000 –∫–º",
                        price: "37,500 ‚Ç¨",
                        features: "–ö–æ–º–ø–∞–∫—Ç–Ω–∏–π SUV",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=425386910"
                    },
                    {
                        id: "422158453",
                        brand: "Mercedes-Benz GLB 250",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "41,000 –∫–º",
                        price: "40,200 ‚Ç¨",
                        features: "7 –º—ñ—Å—Ü—å, –°—ñ–º–µ–π–Ω–∏–π",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=422158453"
                    },
                    {
                        id: "424538448",
                        brand: "BMW X5 xDrive45e",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "65,000 –∫–º",
                        price: "44,800 ‚Ç¨",
                        features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –≤—ñ–¥ 2022 —Ä.",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=424538448"
                    },
                    {
                        id: "421648521",
                        brand: "BMW 330e",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "52,000 –∫–º",
                        price: "38,500 ‚Ç¨",
                        features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –°–ø–æ—Ä—Ç –ø–∞–∫–µ—Ç",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=421648521"
                    },
                    {
                        id: "414011356",
                        brand: "Audi Q5 55 TFSI e",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "38,000 –∫–º",
                        price: "42,900 ‚Ç¨",
                        features: "Quattro, –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414011356"
                    },
                    {
                        id: "415765423",
                        brand: "Volvo XC60 T8",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "45,000 –∫–º",
                        price: "39,500 ‚Ç¨",
                        features: "–≤—ñ–¥ 2020 —Ä., AWD",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=415765423"
                    },
                    {
                        id: "427272252",
                        brand: "Porsche Cayenne E-Hybrid",
                        type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                        mileage: "58,000 –∫–º",
                        price: "48,500 ‚Ç¨",
                        features: "–°–ø–æ—Ä—Ç —Ö—Ä–æ–º–æ, –ü—Ä–µ–º—ñ—É–º",
                        url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427272252"
                    }
                ];

                await autoSave();
                generateTable();
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
                
                console.log('–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ, –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:', carsData.length);
            }
        }

        // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º
        async function sortByPriority() {
            carsData.sort((a, b) => {
                const ratingA = carRatings[a.id] || 'none';
                const ratingB = carRatings[b.id] || 'none';
                
                // –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: priority > interesting > none > not-interesting
                const priorityOrder = {
                    'priority': 4,
                    'interesting': 3,
                    'none': 2,
                    'not-interesting': 1
                };
                
                return priorityOrder[ratingB] - priorityOrder[ratingA];
            });
            
            await autoSave();
            generateTable();
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –í—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏
        function updateRatingDisplay(carId) {
            try {
                const priorityBtn = document.querySelector('#priority-' + carId);
                const interestingBtn = document.querySelector('#interesting-' + carId);
                const notInterestingBtn = document.querySelector('#not-interesting-' + carId);
                const statusSpan = document.querySelector('#status-' + carId);
                
                if (!priorityBtn || !interestingBtn || !notInterestingBtn || !statusSpan) {
                    console.warn('–ù–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è carId:', carId);
                    return;
                }
                
                // –°–∫–∏–¥–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∞–Ω—ñ–≤
                priorityBtn.classList.remove('active');
                interestingBtn.classList.remove('active');
                notInterestingBtn.classList.remove('active');
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —Ç–∞ —Å—Ç–∞—Ç—É—Å—É
                const rating = carRatings[carId];
                
                if (rating === 'priority') {
                    priorityBtn.classList.add('active');
                    statusSpan.textContent = 'üèÜ –¢–û–ü –ü–†–Ü–û–†–ò–¢–ï–¢';
                    statusSpan.className = 'status-indicator status-priority';
                } else if (rating === 'interesting') {
                    interestingBtn.classList.add('active');
                    statusSpan.textContent = 'üëç –¶—ñ–∫–∞–≤–æ';
                    statusSpan.className = 'status-indicator status-interesting';
                } else if (rating === 'not-interesting') {
                    notInterestingBtn.classList.add('active');
                    statusSpan.textContent = 'üëé –ù–µ —Ü—ñ–∫–∞–≤–æ';
                    statusSpan.className = 'status-indicator status-not-interesting';
                } else {
                    statusSpan.textContent = 'ü§î –ù–µ –æ—Ü—ñ–Ω–µ–Ω–æ';
                    statusSpan.className = 'status-indicator status-neutral';
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–µ–π—Ç–∏–Ω–≥—É –¥–ª—è carId:', carId, error);
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—ñ
        function generateTable() {
            try {
                const tbody = document.getElementById('carTable');
                if (!tbody) {
                    console.error('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç carTable');
                    return;
                }
                
                tbody.innerHTML = '';

                carsData.forEach((car, index) => {
                    if (!car || !car.id) {
                        console.warn('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è:', car);
                        return;
                    }

                    const rating = carRatings[car.id] || '';
                    const comment = carComments[car.id] || '';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>
                            <input 
                                type="text" 
                                class="editable-input brand-model-input" 
                                value="${(car.brand || '').replace(/"/g, '&quot;')}"
                                onchange="updateCarData('${car.id}', 'brand', this.value)"
                                placeholder="–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å"
                            >
                        </td>
                        <td>
                            <input 
                                type="text" 
                                class="editable-input" 
                                value="${(car.type || '').replace(/"/g, '&quot;')}"
                                onchange="updateCarData('${car.id}', 'type', this.value)"
                                placeholder="–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞"
                            >
                        </td>
                        <td>
                            <input 
                                type="text" 
                                class="editable-input mileage-input" 
                                value="${(car.mileage || '').replace(/"/g, '&quot;')}"
                                onchange="updateCarData('${car.id}', 'mileage', this.value)"
                                placeholder="–ü—Ä–æ–±—ñ–≥"
                            >
                        </td>
                        <td>
                            <input 
                                type="text" 
                                class="editable-input price-input" 
                                value="${(car.price || '').replace(/"/g, '&quot;')}"
                                onchange="updateCarData('${car.id}', 'price', this.value)"
                                placeholder="–¶—ñ–Ω–∞"
                            >
                        </td>
                        <td>
                            <input 
                                type="text" 
                                class="editable-input features-input" 
                                value="${(car.features || '').replace(/"/g, '&quot;')}"
                                onchange="updateCarData('${car.id}', 'features', this.value)"
                                placeholder="–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ"
                            >
                        </td>
                        <td class="rating-cell">
                            <div class="rating-buttons">
                                <button class="rating-btn priority-btn" id="priority-${car.id}" onclick="rateCar('${car.id}', 'priority')" title="–¢–æ–ø –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç">üèÜ</button>
                                <button class="rating-btn interesting-btn" id="interesting-${car.id}" onclick="rateCar('${car.id}', 'interesting')" title="–¶—ñ–∫–∞–≤–æ">üëç</button>
                                <button class="rating-btn not-interesting-btn" id="not-interesting-${car.id}" onclick="rateCar('${car.id}', 'not-interesting')" title="–ù–µ —Ü—ñ–∫–∞–≤–æ">üëé</button>
                            </div>
                            <span class="status-indicator status-neutral" id="status-${car.id}">ü§î –ù–µ –æ—Ü—ñ–Ω–µ–Ω–æ</span>
                        </td>
                        <td class="comment-cell">
                            <textarea 
                                class="comment-input" 
                                placeholder="–î–æ–¥–∞–π—Ç–µ —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..."
                                onchange="updateComment('${car.id}', this.value)"
                                onkeyup="updateComment('${car.id}', this.value)"
                            >${comment.replace(/"/g, '&quot;')}</textarea>
                        </td>
                        <td class="link-cell">
                            <a href="${car.url || '#'}" target="_blank">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</a>
                        </td>
                        <td class="actions-cell">
                            <button class="delete-btn" onclick="deleteCar('${car.id}')" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                    
                    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
                    setTimeout(() => updateRatingDisplay(car.id), 100);
                });
                
                console.log('–¢–∞–±–ª–∏—Ü—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ, –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:', carsData.length);
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–∞–±–ª–∏—Ü—ñ:', error);
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É...');
            console.log('–ü–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:', carsData.length);
            
            // –°–ø–æ—á–∞—Ç–∫—É –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ
            generateTable();
            
            // –ü–æ—Ç—ñ–º –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ
            await loadSavedData();
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            generateTable();
            
            console.log('‚úÖ –î–æ–¥–∞—Ç–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ –∑ Firebase –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é');
            console.log('–§—ñ–Ω–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:', carsData.length);
        });
    </script>
</body>
</html>
