<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–±–ª–∏—Ü—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ Mobile.de</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1500px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .controls {
            padding: 15px 20px;
            background-color: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .btn {
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .save-btn { background: #27ae60; color: white; }
        .save-btn:hover { background: #219a52; }
        .clear-btn { background: #e74c3c; color: white; }
        .clear-btn:hover { background: #c0392b; }
        .add-btn { background: #3498db; color: white; }
        .add-btn:hover { background: #2980b9; }
        .cancel-btn { background: #95a5a6; color: white; }
        .cancel-btn:hover { background: #7f8c8d; }
        
        .info-text {
            margin-left: 20px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .add-car-form {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            border: 2px dashed #bdc3c7;
            display: none;
        }
        .add-car-form.show {
            display: block;
        }
        .form-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .form-actions {
            display: flex;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        th {
            background-color: #34495e;
            color: white;
            padding: 15px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #2c3e50;
            font-size: 14px;
        }
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: top;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
            transition: background-color 0.3s ease;
        }
        .car-id {
            font-weight: bold;
            color: #2c3e50;
        }
        .link-cell {
            max-width: 180px;
            word-break: break-all;
        }
        .link-cell a {
            color: #3498db;
            text-decoration: none;
            font-size: 13px;
        }
        .link-cell a:hover {
            text-decoration: underline;
            color: #2980b9;
        }
        .editable-input {
            width: 100%;
            border: 1px solid transparent;
            background: transparent;
            padding: 4px;
            font-family: inherit;
            font-size: 14px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        .editable-input:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .brand-model-input {
            font-weight: 600;
            color: #2c3e50;
            min-width: 150px;
        }
        .features-input {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
            min-width: 120px;
        }
        .rating-cell {
            text-align: center;
            width: 100px;
        }
        .rating-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-bottom: 5px;
        }
        .plus-btn, .minus-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .plus-btn {
            background: #27ae60;
            color: white;
        }
        .plus-btn:hover {
            background: #219a52;
            transform: scale(1.1);
        }
        .minus-btn {
            background: #e74c3c;
            color: white;
        }
        .minus-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        .plus-btn.active {
            background: #16a085;
            box-shadow: 0 0 10px rgba(22, 160, 133, 0.5);
        }
        .minus-btn.active {
            background: #c0392b;
            box-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
        }
        .comment-cell {
            width: 250px;
        }
        .comment-input {
            width: 100%;
            min-height: 60px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            padding: 8px;
            font-family: inherit;
            font-size: 13px;
            resize: vertical;
        }
        .comment-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .status-indicator {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        .status-liked {
            background: #d5f4e6;
            color: #27ae60;
        }
        .status-disliked {
            background: #fadbd8;
            color: #e74c3c;
        }
        .status-neutral {
            background: #f8f9fa;
            color: #7f8c8d;
        }
        .actions-cell {
            width: 60px;
            text-align: center;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        @media (max-width: 1200px) {
            .container {
                margin: 10px;
                overflow-x: auto;
            }
            table {
                min-width: 1200px;
            }
        }
        @media (max-width: 768px) {
            .comment-cell {
                width: 200px;
            }
            .comment-input {
                min-height: 50px;
            }
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .info-text {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó –¢–∞–±–ª–∏—Ü—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ Mobile.de</h1>
            <p>–•–º–∞—Ä–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Firebase</p>
        </div>
        
        <div class="sync-status" id="syncStatus" style="padding: 10px 20px; background: #f8f9fa; border-bottom: 1px solid #dee2e6; text-align: center; font-size: 14px;">
            <span style="color: #ffc107;">üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...</span>
        </div>
        
        <div class="controls">
            <button class="btn save-btn" onclick="forceSyncToCloud()">‚òÅÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
            <button class="btn clear-btn" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
            <button class="btn add-btn" onclick="toggleAddForm()">‚ûï –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ</button>
            <span class="info-text">
                ‚òÅÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase + localStorage backup
            </span>
        </div>
        
        <div class="add-car-form" id="addCarForm">
            <h3>‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å</h3>
            <div class="form-group">
                <input type="text" id="newCarId" class="form-input" placeholder="ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è" required>
                <input type="text" id="newCarBrand" class="form-input" placeholder="–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å" required>
                <input type="text" id="newCarType" class="form-input" placeholder="–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞" value="–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥">
            </div>
            <div class="form-group">
                <input type="text" id="newCarFeatures" class="form-input" placeholder="–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ">
                <input type="url" id="newCarUrl" class="form-input" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è" required>
            </div>
            <div class="form-actions">
                <button class="btn add-btn" onclick="addNewCar()">‚úÖ –î–æ–¥–∞—Ç–∏</button>
                <button class="btn cancel-btn" onclick="toggleAddForm()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>‚Ññ</th>
                    <th>ID –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</th>
                    <th>–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å</th>
                    <th>–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞</th>
                    <th>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ</th>
                    <th>–û—Ü—ñ–Ω–∫–∞</th>
                    <th>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</th>
                    <th>–ü–æ—Å–∏–ª–∞–Ω–Ω—è</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody id="carTable">
            </tbody>
        </table>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const firebaseConfig = {
            apiKey: "AIzaSyDl_ZYOx4rvJqYhz5a3rjFCa0XU0Elx4tA",
            authDomain: "car-table-app.firebaseapp.com",
            projectId: "car-table-app",
            storageBucket: "car-table-app.firebasestorage.app",
            messagingSenderId: "1089172844020",
            appId: "1:1089172844020:web:77e5936de00905c1d5dda1"
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // –ó—Ä–æ–±–∏—Ç–∏ Firebase –¥–æ—Å—Ç—É–ø–Ω–∏–º –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.firebaseDb = db;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseOnSnapshot = onSnapshot;
        window.isFirebaseReady = true;

        // –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
        const statusElement = document.getElementById('syncStatus');
        if (statusElement) {
            statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>';
        }

        console.log('Firebase —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
    </script>

    <script>
        // –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
        let carsData = [
            {
                id: "426743473",
                brand: "Mercedes-Benz GLC 300",
                type: "–ì—ñ–±—Ä–∏–¥",
                features: "AHK, –ö–∞–º–µ—Ä–∞, –ü–∞–Ω–æ—Ä–∞–º–∞",
                url: "https://suchen.mobile.de/auto-inserat/mercedes-benz-glc-300-ahk-kamera-pano/426743473.html"
            },
            {
                id: "418664792",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=418664792&action=topInCategory&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B6%3B&od=up&p=%3A44000&rd=150&ref=srp&refId=381b626e-b08d-345a-902d-255afe3d8858&s=Car&sb=p&searchId=381b626e-b08d-345a-902d-255afe3d8858&vc=Car"
            },
            {
                id: "423350671",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423350671&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B6%3B&od=up&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=e8431e72-b82c-c0b1-de51-d501336fb633&s=Car&sb=p&searchId=e8431e72-b82c-c0b1-de51-d501336fb633&vc=Car"
            },
            {
                id: "420538971",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=420538971&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B6%3B&od=up&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=e8431e72-b82c-c0b1-de51-d501336fb633&s=Car&sb=p&searchId=e8431e72-b82c-c0b1-de51-d501336fb633&vc=Car"
            },
            {
                id: "427620635",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427620635&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B6%3B&od=up&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=e8431e72-b82c-c0b1-de51-d501336fb633&s=Car&sb=p&searchId=e8431e72-b82c-c0b1-de51-d501336fb633&vc=Car"
            },
            {
                id: "411812367",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "Eye Catcher, –°—Ç–æ—Ä—ñ–Ω–∫–∞ 5",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=411812367&action=eyeCatcher&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B6%3B&od=up&p=%3A44000&pageNumber=5&rd=150&ref=srp&refId=612ffed2-b4bf-5414-870a-2064dd63e861&s=Car&sb=p&searchId=612ffed2-b4bf-5414-870a-2064dd63e861&vc=Car"
            },
            {
                id: "423733871",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=423733871&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B11%3B&od=up&p=%3A44000&rd=150&ref=srp&refId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&s=Car&sb=p&searchId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&vc=Car"
            },
            {
                id: "414802954",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414802954&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B11%3B&od=up&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=111b4189-0b18-6219-0228-fb776675d06d&s=Car&sb=p&searchId=111b4189-0b18-6219-0228-fb776675d06d&vc=Car"
            },
            {
                id: "425386910",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=425386910&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B11%3B&od=up&p=%3A44000&rd=150&ref=srp&refId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&s=Car&sb=p&searchId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&vc=Car"
            },
            {
                id: "422158453",
                brand: "Mercedes-Benz",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=422158453&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=17200%3B%3B11%3B&od=up&p=%3A44000&rd=150&ref=srp&refId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&s=Car&sb=p&searchId=ad1e346b-5862-9bdc-51c3-c28e7c2287fd&vc=Car"
            },
            {
                id: "424538448",
                brand: "Estate Car",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –≤—ñ–¥ 2022 —Ä., –°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=424538448&c=EstateCar&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2022%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A40000&ms=3500%3B%3B21%3B&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=08f61487-dcaf-1ffd-878d-39a9995320b2&s=Car&searchId=08f61487-dcaf-1ffd-878d-39a9995320b2&vc=Car"
            },
            {
                id: "421648521",
                brand: "Estate Car",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –≤—ñ–¥ 2022 —Ä., –°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=421648521&c=EstateCar&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2022%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A40000&ms=3500%3B%3B21%3B&p=%3A44000&pageNumber=2&rd=150&ref=srp&refId=08f61487-dcaf-1ffd-878d-39a9995320b2&s=Car&searchId=08f61487-dcaf-1ffd-878d-39a9995320b2&vc=Car"
            },
            {
                id: "414011356",
                brand: "Estate Car",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª, –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, –≤—ñ–¥ 2022 —Ä.",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=414011356&action=topInCategory&c=EstateCar&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2022%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A40000&ms=3500%3B%3B21%3B&p=%3A44000&rd=150&ref=srp&refId=7fef437c-92de-20bc-dfd5-940834261047&s=Car&searchId=7fef437c-92de-20bc-dfd5-940834261047&vc=Car"
            },
            {
                id: "415765423",
                brand: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–≤—ñ–¥ 2020 —Ä., –¶—ñ–Ω–∞ 35-44k‚Ç¨, –°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=415765423&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=3500%3B%3B22%3B&od=up&p=35000%3A44000&pageNumber=2&rd=150&ref=srp&refId=d114018e-2c04-a1da-666e-ee0b86a463e5&s=Car&sb=p&searchId=d114018e-2c04-a1da-666e-ee0b86a463e5&vc=Car"
            },
            {
                id: "427272252",
                brand: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å",
                type: "–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥",
                features: "–≤—ñ–¥ 2020 —Ä., –¶—ñ–Ω–∞ 35-44k‚Ç¨, –°—Ç–æ—Ä—ñ–Ω–∫–∞ 2",
                url: "https://suchen.mobile.de/fahrzeuge/details.html?id=427272252&cn=DE&dam=false&fe=HYBRID_PLUGIN&fr=2020%3A&ft=HYBRID&ft=HYBRID_DIESEL&gn=D%C3%BCsseldorf,+Nordrhein-Westfalen&isSearchRequest=true&ll=51.21563,6.77605&ml=%3A60000&ms=1900%3B32%3B%3B&od=up&p=35000%3A44000&pageNumber=2&rd=150&ref=srp&refId=46f2e1a4-c672-137d-dea6-561592631447&s=Car&sb=p&searchId=46f2e1a4-c672-137d-dea6-561592631447&vc=Car"
            }
        ];

        // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–æ–∫ —Ç–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤
        let carRatings = {};
        let carComments = {};
        let isFirebaseReady = false;

        // –ß–µ–∫–∞—î–º–æ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å Firebase
        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.isFirebaseReady && window.firebaseDb) {
                        isFirebaseReady = true;
                        resolve();
                    } else {
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        // Firebase —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        async function syncToFirebase() {
            if (!isFirebaseReady) return false;
            
            try {
                const dataToSync = {
                    carsData: carsData,
                    carRatings: carRatings,
                    carComments: carComments,
                    lastUpdated: new Date().toISOString()
                };

                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                await window.firebaseSetDoc(docRef, dataToSync);
                
                const statusElement = document.getElementById('syncStatus');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ —Ö–º–∞—Ä–æ—é</span>';
                }
                
                console.log('–î–∞–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –∑ Firebase');
                return true;
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∑ Firebase:', error);
                const statusElement = document.getElementById('syncStatus');
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: #dc3545;">‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó</span>';
                }
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!isFirebaseReady) return false;
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                const docSnap = await window.firebaseGetDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.carsData) carsData = data.carsData;
                    if (data.carRatings) carRatings = data.carRatings;
                    if (data.carComments) carComments = data.carComments;
                    
                    console.log('–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∑ Firebase');
                    return true;
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Firebase:', error);
            }
            return false;
        }

        // Real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        function setupRealtimeSync() {
            if (!isFirebaseReady) return;
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                window.firebaseOnSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        if (data.carsData) carsData = data.carsData;
                        if (data.carRatings) carRatings = data.carRatings;
                        if (data.carComments) carComments = data.carComments;
                        
                        generateTable();
                        
                        const statusElement = document.getElementById('syncStatus');
                        if (statusElement) {
                            statusElement.innerHTML = '<span style="color: #17a2b8;">üîÑ –û–Ω–æ–≤–ª–µ–Ω–æ –∑ —Ö–º–∞—Ä–∏</span>';
                            setTimeout(() => {
                                statusElement.innerHTML = '<span style="color: #28a745;">‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ</span>';
                            }, 2000);
                        }
                    }
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ real-time —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:', error);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
        async function loadSavedData() {
            // –°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ localStorage (—à–≤–∏–¥–∫–æ)
            try {
                const savedRatings = localStorage.getItem('carRatings');
                const savedComments = localStorage.getItem('carComments');
                const savedCars = localStorage.getItem('carsData');
                
                if (savedRatings) carRatings = JSON.parse(savedRatings);
                if (savedComments) carComments = JSON.parse(savedComments);
                if (savedCars) carsData = JSON.parse(savedCars);
                
                console.log('–î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∑ localStorage');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage:', error);
            }

            // –ü–æ—Ç—ñ–º —á–µ–∫–∞—î–º–æ Firebase —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ —Ö–º–∞—Ä–∏
            await waitForFirebase();
            const firebaseLoaded = await loadFromFirebase();
            
            if (firebaseLoaded) {
                setupRealtimeSync();
            }
        }

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–ø–æ–¥–≤—ñ–π–Ω–µ: localStorage + Firebase)
        async function autoSave() {
            // –ó–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage (—à–≤–∏–¥–∫–æ)
            try {
                localStorage.setItem('carRatings', JSON.stringify(carRatings));
                localStorage.setItem('carComments', JSON.stringify(carComments));
                localStorage.setItem('carsData', JSON.stringify(carsData));
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ localStorage:', error);
            }

            // –Ü –≤ Firebase —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π
            if (isFirebaseReady) {
                await syncToFirebase();
            }
        }

        // –ü—Ä–∏–º—É—Å–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        async function forceSyncToCloud() {
            const statusElement = document.getElementById('syncStatus');
            if (statusElement) {
                statusElement.innerHTML = '<span style="color: #ffc107;">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...</span>';
            }
            
            await autoSave();
        }

        // –§—É–Ω–∫—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function saveData(event) {
            await autoSave();
            
            if (event && event.target) {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }
        }

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        // (—Ñ—É–Ω–∫—Ü—ñ—è –≤–∂–µ –≤–∏–∑–Ω–∞—á–µ–Ω–∞ –≤–∏—â–µ)

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
        async function clearAllData() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ (–∞–≤—Ç–æ, –æ—Ü—ñ–Ω–∫–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ)?')) {
                carRatings = {};
                carComments = {};
                localStorage.removeItem('carRatings');
                localStorage.removeItem('carComments');
                localStorage.removeItem('carsData');
                
                // –û—á–∏—Å—Ç–∏—Ç–∏ Firebase
                if (isFirebaseReady) {
                    try {
                        const docRef = window.firebaseDoc(window.firebaseDb, 'carTable', 'data');
                        await window.firebaseSetDoc(docRef, {
                            carsData: [],
                            carRatings: {},
                            carComments: {},
                            lastUpdated: new Date().toISOString()
                        });
                    } catch (error) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è Firebase:', error);
                    }
                }
                
                location.reload();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è
        function toggleAddForm() {
            const form = document.getElementById('addCarForm');
            if (form) {
                form.classList.toggle('show');
                
                if (form.classList.contains('show')) {
                    const idInput = document.getElementById('newCarId');
                    if (idInput) idInput.focus();
                } else {
                    // –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
                    const inputs = ['newCarId', 'newCarBrand', 'newCarFeatures', 'newCarUrl'];
                    inputs.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) element.value = '';
                    });
                    const typeInput = document.getElementById('newCarType');
                    if (typeInput) typeInput.value = '–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥';
                }
            }
        }

        // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
        async function addNewCar() {
            const id = document.getElementById('newCarId')?.value?.trim() || '';
            const brand = document.getElementById('newCarBrand')?.value?.trim() || '';
            const type = document.getElementById('newCarType')?.value?.trim() || '–ü–ª–∞–≥—ñ–Ω-–≥—ñ–±—Ä–∏–¥';
            const features = document.getElementById('newCarFeatures')?.value?.trim() || '';
            const url = document.getElementById('newCarUrl')?.value?.trim() || '';

            if (!id || !brand || !url) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è: ID, –ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å —Ç–∞ –ü–æ—Å–∏–ª–∞–Ω–Ω—è');
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—î –≤–∂–µ –∞–≤—Ç–æ –∑ —Ç–∞–∫–∏–º ID
            if (carsData.find(car => car.id === id)) {
                alert('–ê–≤—Ç–æ–º–æ–±—ñ–ª—å –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!');
                return;
            }

            // –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
            const newCar = {
                id: id,
                brand: brand,
                type: type,
                features: features,
                url: url
            };

            carsData.push(newCar);
            await autoSave();
            generateTable();
            toggleAddForm();
        }

        // –í–∏–¥–∞–ª–∏—Ç–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—å
        async function deleteCar(carId) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å?')) {
                carsData = carsData.filter(car => car.id !== carId);
                delete carRatings[carId];
                delete carComments[carId];
                await autoSave();
                generateTable();
            }
        }

        // –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è
        async function updateCarData(carId, field, value) {
            const car = carsData.find(c => c.id === carId);
            if (car) {
                car[field] = value;
                await autoSave();
            }
        }

        // –û—Ü—ñ–Ω–∫–∞ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è
        async function rateCar(carId, rating) {
            carRatings[carId] = rating;
            await autoSave();
            updateRatingDisplay(carId);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è
        async function updateComment(carId, comment) {
            carComments[carId] = comment;
            await autoSave();
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏
        function updateRatingDisplay(carId) {
            const plusBtn = document.querySelector('#plus-' + carId);
            const minusBtn = document.querySelector('#minus-' + carId);
            const statusSpan = document.querySelector('#status-' + carId);
            
            if (!plusBtn || !minusBtn || !statusSpan) return;
            
            // –°–∫–∏–¥–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∞–Ω—ñ–≤
            plusBtn.classList.remove('active');
            minusBtn.classList.remove('active');
            
            // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —Ç–∞ —Å—Ç–∞—Ç—É—Å—É
            if (carRatings[carId] === 'plus') {
                plusBtn.classList.add('active');
                statusSpan.textContent = '–ü–æ–¥–æ–±–∞—î—Ç—å—Å—è';
                statusSpan.className = 'status-indicator status-liked';
            } else if (carRatings[carId] === 'minus') {
                minusBtn.classList.add('active');
                statusSpan.textContent = '–ù–µ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è';
                statusSpan.className = 'status-indicator status-disliked';
            } else {
                statusSpan.textContent = '–ù–µ –æ—Ü—ñ–Ω–µ–Ω–æ';
                statusSpan.className = 'status-indicator status-neutral';
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—ñ
        function generateTable() {
            const tbody = document.getElementById('carTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';

            carsData.forEach((car, index) => {
                const rating = carRatings[car.id] || '';
                const comment = carComments[car.id] || '';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="car-id">${car.id}</td>
                    <td>
                        <input 
                            type="text" 
                            class="editable-input brand-model-input" 
                            value="${car.brand || ''}"
                            onchange="updateCarData('${car.id}', 'brand', this.value)"
                            placeholder="–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å"
                        >
                    </td>
                    <td>
                        <input 
                            type="text" 
                            class="editable-input" 
                            value="${car.type || ''}"
                            onchange="updateCarData('${car.id}', 'type', this.value)"
                            placeholder="–¢–∏–ø –¥–≤–∏–≥—É–Ω–∞"
                        >
                    </td>
                    <td>
                        <input 
                            type="text" 
                            class="editable-input features-input" 
                            value="${car.features || ''}"
                            onchange="updateCarData('${car.id}', 'features', this.value)"
                            placeholder="–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ"
                        >
                    </td>
                    <td class="rating-cell">
                        <div class="rating-buttons">
                            <button class="plus-btn" id="plus-${car.id}" onclick="rateCar('${car.id}', 'plus')" title="–ü–æ–¥–æ–±–∞—î—Ç—å—Å—è">+</button>
                            <button class="minus-btn" id="minus-${car.id}" onclick="rateCar('${car.id}', 'minus')" title="–ù–µ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è">-</button>
                        </div>
                        <span class="status-indicator status-neutral" id="status-${car.id}">–ù–µ –æ—Ü—ñ–Ω–µ–Ω–æ</span>
                    </td>
                    <td class="comment-cell">
                        <textarea 
                            class="comment-input" 
                            placeholder="–î–æ–¥–∞–π—Ç–µ —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..."
                            onchange="updateComment('${car.id}', this.value)"
                            onkeyup="updateComment('${car.id}', this.value)"
                        >${comment}</textarea>
                    </td>
                    <td class="link-cell">
                        <a href="${car.url || '#'}" target="_blank">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</a>
                    </td>
                    <td class="actions-cell">
                        <button class="delete-btn" onclick="deleteCar('${car.id}')" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
                setTimeout(() => updateRatingDisplay(car.id), 50);
            });
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            generateTable();
            console.log('–î–æ–¥–∞—Ç–æ–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
        });
    </script>
</body>
</html>
